<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Stoichiometry Practice – IGCSE</title>
  <style>
    :root {
      --primary: #2f8fda;
      --muted: #666;
      --card-bg: #ffffff;
      --surface: #f5f5f5;
      --success: #1b8a4a;
      --danger: #c0392b;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      max-width: 900px;
      margin: 0 auto;
      padding: 1.5rem;
      background: var(--surface);
      color: #222;
    }
    h1 {
      font-size: 1.8rem;
      margin-bottom: 0.3rem;
    }
    .tagline {
      margin-bottom: 1rem;
      font-size: 0.95rem;
      color: #555;
    }
    .card {
      background: var(--card-bg);
      border-radius: 0.75rem;
      padding: 1rem 1.2rem;
      margin-bottom: 1rem;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
    }
    .label {
      font-size: 0.85rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.04em;
      color: #555;
      margin-bottom: 0.3rem;
    }
    .equation {
      font-weight: 600;
      font-size: 1.05rem;
      margin-bottom: 0.3rem;
    }
    .description {
      font-size: 0.9rem;
      color: #555;
      margin-bottom: 0.5rem;
    }
    .question-text {
      font-size: 1rem;
      margin-bottom: 0.2rem;
    }
    .question-meta {
      font-size: 0.85rem;
      color: #555;
      margin-bottom: 0.6rem;
    }

    /* Responsive form controls */
    input[type="number"],
    input[type="text"] {
      padding: 0.3rem 0.5rem;
      border-radius: 0.4rem;
      border: 1px solid #ccc;
      font-size: 1rem;
      box-sizing: border-box;
      max-width: 100%;
    }
    /* Allow flexible widths in control rows */
    .controls-row input[type="text"] {
      min-width: 0;
      flex: 1 1 180px;
    }
    .controls-row input[type="number"] {
      width: 160px;
      flex: 0 0 160px;
    }

    .unit {
      margin-left: 0.2rem;
      font-size: 0.9rem;
    }
    .buttons {
      margin-top: 0.8rem;
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }
    button {
      border: none;
      border-radius: 999px;
      padding: 0.45rem 0.9rem;
      font-size: 0.9rem;
      cursor: pointer;
      background: var(--primary);
      color: white;
    }
    button.secondary {
      background: #e0e0e0;
      color: #333;
    }
    button:disabled {
      cursor: not-allowed;
      opacity: 0.6;
    }
    .feedback {
      margin-top: 0.7rem;
      font-weight: 600;
      font-size: 0.95rem;
    }
    .feedback.correct {
      color: var(--success);
    }
    .feedback.incorrect {
      color: var(--danger);
    }
    .solution-steps {
      margin-top: 0.5rem;
      font-size: 0.9rem;
      line-height: 1.4;
    }
    .solution-steps p {
      margin: 0.2rem 0;
    }
    .solution-steps strong {
      font-weight: 600;
    }
    .controls-row {
      margin-bottom: 0.5rem;
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 0.5rem;
    }
    select {
      padding: 0.25rem 0.5rem;
      border-radius: 0.4rem;
      border: 1px solid #ccc;
      font-size: 0.9rem;
    }
    .note {
      font-size: 0.8rem;
      color: var(--muted);
      margin-top: 0.3rem;
    }
    .pill {
      display: inline-block;
      padding: 0.15rem 0.5rem;
      border-radius: 999px;
      background: #e8f2fc;
      color: #1f4f91;
      font-size: 0.78rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-left: 0.3rem;
    }
    .small {
      font-size: 0.85rem;
      color: #555;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.85rem;
      margin-top: 0.4rem;
    }
    th, td {
      border-bottom: 1px solid #eee;
      padding: 0.25rem 0.3rem;
      text-align: left;
    }
    th {
      font-weight: 600;
      background: #f7f7f7;
    }
    .badge {
      display: inline-block;
      padding: 0.05rem 0.4rem;
      border-radius: 999px;
      background: #e9f7ef;
      color: #1b8a4a;
      font-size: 0.75rem;
      font-weight: 600;
    }

    /* Accessibility helper */
    .sr-only {
      position: absolute !important;
      height: 1px; width: 1px;
      overflow: hidden;
      clip: rect(1px, 1px, 1px, 1px);
      white-space: nowrap;
    }

    /* Player feedback */
    .player-feedback {
      margin-top: 0.5rem;
      font-size: 0.9rem;
      color: var(--muted);
    }
    .player-feedback.success { color: var(--success); font-weight:600; }
    .player-feedback.error { color: var(--danger); font-weight:600; }
  </style>
</head>
<body>
  <h1>Stoichiometry Practice</h1>
  <div class="tagline">
    Year 9/10 IGCSE practice – mass ↔ mass, mass ↔ gas volume, gas ↔ gas, concentration questions.  
    Enter your answer to 2–3 s.f. The app accepts small rounding differences.
  </div>

  <!-- Player + analytics controls -->
  <div class="card" aria-labelledby="playerLabel">
    <div class="label" id="playerLabel">Player</div>
    <div class="controls-row" role="group" aria-label="Player controls">
      <label for="playerNameInput" class="sr-only">Player name</label>
      <input type="text" id="playerNameInput" placeholder="Enter your name or nickname" maxlength="32" aria-describedby="playerHelp">
      <div style="display:flex; gap:.5rem;">
        <button id="setPlayerBtn">Set player</button>
        <button id="clearPlayerBtn" class="secondary" type="button">Reset</button>
      </div>
    </div>
    <div class="small" id="currentPlayerLabel">Current player: <strong aria-live="polite">Guest</strong></div>
    <div id="playerHelp" class="note">Leaderboard and stats are saved in this browser only (using localStorage).</div>
    <div id="playerFeedback" class="player-feedback" aria-live="polite"></div>
  </div>

  <!-- Remaining app content (questions, controls, results) goes here -->
  <!-- ... -->

  <noscript class="card">
    <div class="label">JavaScript required</div>
    <div class="description">This app needs JavaScript enabled to work. Please enable JavaScript in your browser.</div>
  </noscript>

  <script>
    (function () {
      const STORAGE_KEY = 'stoich.player';
      const MAX_NAME_LENGTH = 32;

      const inputEl = document.getElementById('playerNameInput');
      const setBtn = document.getElementById('setPlayerBtn');
      const clearBtn = document.getElementById('clearPlayerBtn');
      const currentLabelStrong = document.querySelector('#currentPlayerLabel strong');
      const feedbackEl = document.getElementById('playerFeedback');

      function showFeedback(message, type) {
        feedbackEl.textContent = message;
        feedbackEl.className = 'player-feedback' + (type ? ' ' + type : '');
      }

      function sanitizeName(name) {
        if (!name) return '';
        // Normalize whitespace and strip problematic characters (simple)
        return name.trim().replace(/\s+/g, ' ').slice(0, MAX_NAME_LENGTH);
      }

      function setPlayer(name) {
        const sanitized = sanitizeName(name);
        if (!sanitized) {
          showFeedback('Please enter a name before setting player.', 'error');
          return false;
        }
        try {
          localStorage.setItem(STORAGE_KEY, sanitized);
          currentLabelStrong.textContent = sanitized;
          showFeedback('Player set: ' + sanitized, 'success');
          return true;
        } catch (err) {
          console.error('Could not save player name', err);
          showFeedback('Could not save player name (storage unavailable).', 'error');
          return false;
        }
      }

      function clearPlayer() {
        try {
          localStorage.removeItem(STORAGE_KEY);
        } catch (err) {
          console.warn('Failed to clear storage', err);
        }
        currentLabelStrong.textContent = 'Guest';
        inputEl.value = '';
        showFeedback('Player reset to Guest.');
      }

      setBtn.addEventListener('click', () => {
        setPlayer(inputEl.value);
      });

      clearBtn.addEventListener('click', () => {
        clearPlayer();
      });

      inputEl.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
          e.preventDefault();
          setPlayer(inputEl.value);
        }
      });

      document.addEventListener('DOMContentLoaded', () => {
        let saved = null;
        try {
          saved = localStorage.getItem(STORAGE_KEY);
        } catch (err) {
          // ignore
        }
        if (saved) {
          const value = sanitizeName(saved);
          currentLabelStrong.textContent = value;
          inputEl.value = value;
          showFeedback('Loaded saved player: ' + value, 'success');
        } else {
          currentLabelStrong.textContent = 'Guest';
        }
      });
    })();
  </script>
</body>
</html>
